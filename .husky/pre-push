#!/usr/bin/env sh
. "$(dirname -- "$0")/_/husky.sh"

# ANSI é¢œè‰²å®šä¹‰
GREEN="\033[0;32m"
YELLOW="\033[0;33m"
BLUE="\033[0;34m"
RESET="\033[0m"

echo "ğŸ” Checking changeset status..."

# æ£€æŸ¥ changeset
if pnpm changeset status --since=origin/master >/dev/null 2>&1; then
  echo "${GREEN}âœ… Changeset detected. Good job!${RESET}"
else
  echo "${YELLOW}âš ï¸  No changesets found! If you want to publish, please run 'pnpm run changeset' to add one.${RESET}"
fi

# ç»Ÿè®¡æ–‡ä»¶æ”¹åŠ¨å’Œcommitsæ•°æ®
echo ""
echo "ğŸ“Š Commit Summary:"

# è·å–æ¨é€çš„ commit èŒƒå›´
COMMITS=$(git rev-list origin/master..HEAD)

if [ -z "$COMMITS" ]; then
  echo "${YELLOW}âš ï¸  No new commits to push.${RESET}"
else
  COUNT=$(echo "$COMMITS" | wc -l | tr -d ' ')
  FILES=$(git diff --name-only origin/master..HEAD | wc -l | tr -d ' ')
  AUTHOR=$(git log -1 --pretty=format:'%an')

  echo "${BLUE}ğŸ‘¤ Author: $AUTHOR${RESET}"
  echo "${BLUE}ğŸ“¦ Commits: $COUNT${RESET}"
  echo "${BLUE}ğŸ“‚ Changed Files: $FILES${RESET}"
  echo "${BLUE}ğŸ“ Latest Commit Message:${RESET}"
  git --no-pager log origin/master..HEAD --pretty=format:"- %s" --abbrev-commit -n 1
fi

echo ""
printf "%b\n" "â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€"
echo ""
